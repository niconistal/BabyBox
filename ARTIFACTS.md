# BabyBox — Artifacts Spec

This document catalogs every deliverable in the project and the tools and workflows
used to produce them. Artifacts tagged **[AI]** are primarily AI-generated.

---

## Artifact Map

```
BabyBox Artifacts
├── Content (what the child sees and hears)
│   └── [ ] YouTube media (downloaded by parent via web UI)
├── Physical (what the child touches)
│   ├── [AI] Figurines (3D models generated with Meshy AI, post-processed)
│   ├── [AI] Enclosure (OpenSCAD code generated by Claude Code)
│   ├── [AI] Figurine base template (OpenSCAD code generated by Claude Code)
│   └── [ ] Electronics assembly (manual)
└── Software (what runs on the Pi)
    └── [AI] Application code (written with Claude Code)
```

**Content is NOT AI-generated.** Parents curate content from YouTube and download
it to the device via the web UI. The app handles downloading and format conversion.

---

## 1. YouTube Media (parent-curated)

All media comes from YouTube. Parents paste URLs into the web UI and choose whether
to save each item as video or audio-only.

| Attribute       | Detail                                              |
|-----------------|-----------------------------------------------------|
| **Source**      | YouTube                                              |
| **Download tool** | `yt-dlp` (running on the Pi)                      |
| **Video format**| MP4 (H.264, up to 1080p)                            |
| **Audio format**| MP3 (extracted from video, 192kbps)                  |
| **Thumbnails**  | Auto-downloaded from YouTube metadata                |
| **Storage**     | `media/video/`, `media/audio/`, `media/thumbnails/`  |

### Download Modes

| Mode       | What happens                                        | Use case                      |
|------------|-----------------------------------------------------|-------------------------------|
| **Video**  | Downloads best MP4 stream (up to 1080p) + audio merged | Cartoons, music videos, shows |
| **Audio**  | Extracts audio track only, converts to MP3           | Songs, lullabies, stories     |

### How it works (via web UI)

```
1. Parent pastes a YouTube URL into the Media Library page
2. Selects "Video" or "Audio only"
3. Clicks "Download"
4. Backend calls yt-dlp:
   Video: yt-dlp -f "bv*[height<=1080]+ba" --merge-output-format mp4 \
          --write-thumbnail -o "media/video/%(id)s.%(ext)s" <URL>
   Audio: yt-dlp -x --audio-format mp3 --audio-quality 192K \
          --write-thumbnail -o "media/audio/%(id)s.%(ext)s" <URL>
5. Metadata (title, duration, thumbnail) is auto-populated into SQLite
6. Media appears in the library, ready to assign to a figurine
```

### yt-dlp considerations

- `yt-dlp` must be kept updated (`yt-dlp -U`) as YouTube frequently changes
  its API — a cron job or update button in the web UI handles this
- Downloads run in the background so the web UI stays responsive
- The Pi Zero 2 W is slow — a 3-minute video may take a few minutes to download
  and transcode. Progress is shown in the web UI.
- Storage: a 32 GB SD card holds ~50 hours of 720p video or ~500 hours of MP3 audio

---

## 2. [AI] 3D Figurines

Small 3D-printed characters that the child places on the box. Each figurine
contains an RFID tag and magnets (see SPEC.md section 6).

| Attribute       | Detail                                              |
|-----------------|-----------------------------------------------------|
| **Model tool**  | Meshy AI (text/image-to-3D)                          |
| **Post-process**| Blender (cleanup, magnet cavities, base)             |
| **Slicer**      | Bambu Studio                                         |
| **Printer**     | Bambu Lab P2S                                        |
| **Output**      | Physical PETG/PLA figurine, 40-60mm tall              |
| **Cost**        | Meshy free tier available; ~$0.20 filament per figurine |

### Why Meshy AI?

- Built-in "Add Base" tool — creates a flat bottom for magnet embedding
- Direct "Send to Bambu" integration with Bambu Studio
- Exports STL and 3MF natively
- Blender plugin for post-processing
- Free tier is sufficient for this project's volume

### Workflow

```
1. Generate a reference image (optional but recommended)
   └─ Use Midjourney / DALL-E / Flux:
      "Cute cartoon dinosaur figurine, simple round shapes, bright green,
       front view, white background, 3D render style, no fine details"
   └─ Simple designs = better 3D generation results

2. Generate 3D model in Meshy AI
   └─ Use image-to-3D mode (upload the reference image)
   └─ OR use text-to-3D: "cute simple cartoon bunny figurine, round body,
      big eyes, smooth surface, flat base"
   └─ Generate 2-3 variants, pick the best
   └─ Use Meshy's "Add Base" tool to ensure a flat bottom

3. Post-process in Blender (~10 min per model)
   └─ Import the mesh (STL/OBJ)
   └─ Check manifold: Select > All by Trait > Non-Manifold → fix any issues
   └─ Thicken thin features (ears, limbs) to min 2mm for toddler safety
   └─ Round off any sharp points
   └─ Boolean subtract magnet cavities from the base:
      - 2x cylinders: 6.3mm diameter x 3.2mm deep (6mm magnet + tolerance)
      - Centers 20mm apart (matching box magnets)
   └─ Boolean subtract RFID tag recess:
      - Cylinder: 25.5mm diameter x 0.5mm deep (coin sticker sits flush)
      - Centered in the base
   └─ Verify base is flat, total base thickness >= 5mm
   └─ Export as STL

4. Slice in Bambu Studio
   └─ Import STL, scale to target height (40-60mm)
   └─ Orient flat base down
   └─ Layer height: 0.16mm (good detail vs. speed tradeoff)
   └─ Infill: 15-20% (lightweight but sturdy)
   └─ Material: PETG (stronger) or PLA (easier, more colors)
   └─ Add tree supports for overhangs >45 degrees
   └─ Add pause at layer just above magnet cavities:
      "Pause at layer [N] — insert magnets (check polarity!)"
   └─ Send to printer

5. Assembly (post-print)
   └─ Remove supports, light sanding
   └─ Insert magnets into cavities (verify polarity against box magnets!)
   └─ Seal magnets with a drop of super glue or UV resin
   └─ Stick RFID coin tag into the base recess
   └─ Optional: seal base with a thin 3D-printed cap or sticker

6. Register
   └─ Place figurine on the box
   └─ Open web UI → Figurine Manager → assign to a media file
```

### Figurine Base Template (standardized)

Every figurine shares this base geometry, regardless of what sits on top:

```
     Top view (base underside)            Cross-section
     ┌─────────────────────┐
     │                     │              ┌─────────────────┐
     │  (○)           (○)  │  magnets     │▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│ figurine body
     │   6.3mm        6.3mm│              │─────────────────│
     │     ←── 20mm ──→    │              │  ○   [RFID]  ○  │ base (5mm)
     │                     │              │  mag  tag   mag │
     │   ┌─────────────┐   │              └─────────────────┘
     │   │  RFID recess│   │
     │   │   25.5mm    │   │
     │   └─────────────┘   │
     │                     │
     └─────────────────────┘
           35mm wide
```

A Blender template file with the base already modeled (magnet cavities, RFID
recess, correct dimensions) will be created so new figurine tops can simply be
Boolean-unioned onto it.

### Alternative: Tripo3D or Sloyd

| Tool      | Strength                               | Weakness                    |
|-----------|----------------------------------------|-----------------------------|
| Meshy AI  | Bambu integration, "Add Base" tool     | Some meshes need cleanup     |
| Tripo3D   | Fastest generation, clean topology     | No native "add base" feature |
| Sloyd     | "3D Print" preset = watertight meshes  | Less detail on characters    |

---

## 3. [AI] Enclosure & Figurine Base (OpenSCAD)

The enclosure and figurine base template are parametric OpenSCAD scripts generated
by Claude Code. OpenSCAD is a code-based CAD tool — geometry is defined by writing
scripts, which makes it a natural fit for AI generation.

| Attribute       | Detail                                              |
|-----------------|-----------------------------------------------------|
| **Design tool** | Claude Code → OpenSCAD `.scad` files                 |
| **Renderer**    | OpenSCAD (renders `.scad` → STL)                     |
| **Slicer**      | Bambu Studio                                         |
| **Printer**     | Bambu Lab P2S                                        |
| **Material**    | PETG                                                 |

### Files generated

| File                     | What it defines                                    |
|--------------------------|----------------------------------------------------|
| `babybox-case.scad`     | Main box body: walls, button holes, LED slot, port cutouts, internal mounts |
| `babybox-lid.scad`      | Lid/top: magnet pockets, RFID module mount, figurine placement marker |
| `base-template.scad`    | Standard figurine base: magnet cavities, RFID recess, flat bottom |

### Why OpenSCAD + Claude Code?

- **Code = AI-friendly:** OpenSCAD scripts are just code — Claude Code writes them
  the same way it writes Python
- **Parametric:** All dimensions are variables at the top of the file. Change
  `wall_thickness = 3;` to `4` and re-render — everything adjusts automatically
- **Reproducible:** No manual mouse-driven modeling. The exact geometry is in the
  script and version-controlled in git
- **Iterative:** Easy to ask Claude Code to "make the button holes 2mm bigger" or
  "add ventilation slots" — it edits the script and you re-render

### Workflow

```
1. Claude Code generates the .scad files based on SPEC.md dimensions
   └─ Enclosure: 120x90x60mm, 3mm walls, rounded corners
   └─ All component positions parameterized (GPIO header, MFRC522, etc.)

2. Open in OpenSCAD and preview (F5)
   └─ Visual check: does it look right?
   └─ Cross-section view to check internal mounts and cavities

3. Iterate with Claude Code
   └─ "The HDMI cutout is 2mm too low" → edit the script → re-preview
   └─ Repeat until satisfied

4. Render (F6) and export STL

5. Import STL into Bambu Studio
   └─ Slice with PETG profile
   └─ Print
```

### Figurine base template usage

The `base-template.scad` file defines the standard base that all figurines share.
To make a new figurine:

```
1. Generate figurine top in Meshy AI (animal, vehicle, character)
2. Export as STL
3. In Blender:
   └─ Import the Meshy STL (figurine top)
   └─ Import the base-template STL (rendered from OpenSCAD)
   └─ Align and Boolean union them
   └─ Export combined STL
4. Slice and print in Bambu Studio
```

See SPEC.md section 7 for full enclosure design requirements.

---

## 4. [AI] Application Software

All Python code for the BabyBox is written with AI assistance (Claude Code).

| Attribute       | Detail                                              |
|-----------------|-----------------------------------------------------|
| **Tool**        | Claude Code (Claude Opus)                            |
| **Language**    | Python 3                                             |
| **Output**      | Source files in `software/`                           |
| **Review**      | All code reviewed and tested by the developer        |

### What AI generates

- Core controller, RFID listener, media player wrapper, LED/buzzer drivers
- YouTube downloader (`yt-dlp` wrapper with format selection)
- SQLite database layer and data models
- Flask web UI (backend routes + HTML/CSS/JS templates)
- Bluetooth connection management
- systemd service files and setup scripts

### What stays manual

- GPIO pin testing and hardware debugging
- Bluetooth pairing troubleshooting
- System-level configuration (raspi-config, SPI enable, etc.)
- Final integration testing on the physical Pi

---

## Summary: Tool Stack

| Artifact             | Tool               | AI?  | Output Format |
|----------------------|--------------------|------|---------------|
| Videos for playback  | YouTube + yt-dlp   | No   | MP4           |
| Audio for playback   | YouTube + yt-dlp   | No   | MP3           |
| Enclosure CAD        | Claude Code → OpenSCAD | Yes | .scad → STL |
| Figurine base template | Claude Code → OpenSCAD | Yes | .scad → STL |
| Figurine 3D models   | Meshy AI           | Yes  | STL           |
| Figurine post-process| Blender            | No   | STL           |
| Figurine reference images | Midjourney / DALL-E | Yes | PNG      |
| Application code     | Claude Code        | Yes  | Python / HTML |
